<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/epubcheck-website/css/style.css">
    <title>EPUBCheck&nbsp;-&nbsp;Developer Guide: Test Suite</title>
</head>

<body>
    <header>
        <h1 class="title"><a href="/epubcheck-website/">EPUBCheck</a>:&nbsp; <a href="/epubcheck-website/docs/dev"> Developer Guide </a></h1>
        <nav aria-label="Main sections">
            <ul>
                <li><a href="/epubcheck-website/docs">Docs</a></li>
                <li><a href="/epubcheck-website/about">About</a></li>
            </ul>
        </nav>
        <form id="search" action="https://duckduckgo.com" method="get">
            <input name="q" type="text" value="" placeholder="Search" aria-label="Search">
            <input type="hidden" name="sites" value="https://daisy.github.io/epubcheck-website">
            <noscript>
                <button type="submit"><img src="/images/searchIcon.svg" alt="search"></button>
            </noscript>
        </form>
    </header>
    <main>
        <h1>Test Suite</h1>
        <!-- TOC depthfrom:2 -->
        <ul>
            <li><a href="#introduction">Introduction</a></li>
            <li><a href="#functional-tests">Functional Tests</a>
                <ul>
                    <li><a href="#overview">Overview</a></li>
                    <li><a href="#a-cucumber-test">A Cucumber Test</a></li>
                    <li><a href="#steps-reference">Steps reference</a>
                        <ul>
                            <li><a href="#setting-the-location-of-test-files">Setting the location of test files</a></li>
                            <li><a href="#configuring-epubcheck">Configuring EPUBCheck</a></li>
                            <li><a href="#running-epubcheck">Running EPUBCheck</a></li>
                            <li><a href="#expecting-epubcheck-results">Expecting EPUBCheck results</a></li>
                        </ul>
                    </li>
                    <li><a href="#test-files-organization">Test Files Organization</a>
                        <ul>
                            <li><a href="#directory-layout">Directory layout</a></li>
                            <li><a href="#feature-files-organization">Feature files organization</a></li>
                            <li><a href="#test-files-organization">Test files organization</a></li>
                        </ul>
                    </li>
                    <li><a href="#underlying-java-code">Underlying Java code</a></li>
                </ul>
            </li>
            <li><a href="#unit-tests">Unit tests</a></li>
            <li><a href="#integration-tests">Integration tests</a></li>
            <li><a href="#how-to-run-tests">How to Run Tests</a>
                <ul>
                    <li><a href="#running-tests-from-the-command-line">Running tests from the command line</a></li>
                    <li><a href="#running-tests-from-the-development-environment">Running tests from the development environment</a></li>
                    <li><a href="#tips-to-run-and-debug-a-single-test">Tips to run and debug a single test</a></li>
                </ul>
            </li>
        </ul>
        <!-- /TOC -->
        <h2 id="introduction"><a class="direct-link" href="#introduction">§</a> Introduction</h2>
        <p>The primary purpose of EPUBCheck is to assert whether an EPUB publication (or compoenent thereof) conforms to the EPUB specifications.<br>
EPUBCheck is used daily by ebook authors, publishers, and distributors, as a quality assurance tool.<br>
It is crucial that it gives the correct results, so that it can be trusted by the digital publishing industry and community.</p>
            <p>Software bugs in EPUBCheck, or flaws in its logic, could result in false positives, or false negatives, or runtime errors:</p>
            <ul>
                <li>A <em>false positive</em> is when EPUBCheck reports that the input does not conform to EPUB specificiations when it is in fact perfectly conforming.<br>
This could cause a valid EPUB to be unjustifiably rejected from a reseller’s ingestion pipeline, for instance.</li>
                <li>A <em>false negative</em> is when EPUBCheck reports that the input conforms to the EPUB specifications when it is in fact non-conforming.<br>
This could cause interoperability issues where an invalid EPUB could not be read correctly on a Reading System expecting valid content.</li>
                <li>A <em>runtime error</em> is when EPUBCheck terminates before even being able to report if the input is or is not conforming to the specifications.<br>
This is also known as a software crash.<br>
The issue here is that users are simply denied an answer to their question about the conformance of their publication.</li>
            </ul>
            <p>These three kinds of errors all have obvious negative impacts.</p>
            <p>In order to verify that EPUBCheck runs without errors and returns the expected results, the source code includes a series of automated tests. These tests can be grouped into the following categories:</p>
            <ul>
                <li><em><a href="#functional-tests">Functional Tests</a></em>: the tests which verify that EPUBCheck correctly evaluates the conformance to EPUB specifications</li>
                <li><em><a href="#unit-tests">Unit Tests</a></em>: the tests which verify the functionality of a specific part of the code, such as a utility class or an API.</li>
                <li><em><a href="#integration-tests">Integration Tests</a></em>: the tests that verify that the entire system, executed as a whole, functions as expected.</li>
            </ul>
            <p>The tests are executed automatically at build time.<br>
They are run for instance by our Continuous Integretion build server whenever new code is pushed to the <code>master</code> branch.<br>
Tests can also be executed on demand during the development, individually or not.<br>
For more information on how the tests can be executed, refer to the section <a href="#how-to-run-tests">How to Run Tests</a>.</p>
            <h2 id="functional-tests"><a class="direct-link" href="#functional-tests">§</a> Functional Tests</h2>
            <h3 id="overview"><a class="direct-link" href="#overview">§</a> Overview</h3>
            <p>EPUBCheck’s <em>functional tests</em> form the biggest and most crucial part of the test suite.<br>
Their role is to verify that EPUBCheck correctly evaluates the conformance criteria defined in the EPUB specifications.</p>
                <p>These tests follow a “black box” testing approach:<br>
the principle is to run EPUBCheck on an input file (or set of files), and then to inspect the resulting output, without having to know exactly how the logic is implemented internally.</p>
                    <p>In order to make the functional tests as readable as possible,<br>
and also understandable and maintainable by people who aren’t necessarily familiar with the Java language,<br>
this part of the test suite relies on the <a href="https://cucumber.io/docs/guides/overview/#what-is-gherkin"><em>Gherkin</em> language</a> and the <a href="https://cucumber.io/docs/guides/overview/#what-is-cucumber"><em>Cucumber</em> tool</a>.<br>
The Gherkin language allows test cases to be specified in a natural language syntax in plain text files (<code>.feature</code> files).<br>
Cucumber is the tool that parses the Gherkin test case specifications and execute the associated Java code to evaluate if the tests pass or fail.</p>
                        <p>The following sections describe:</p>
                        <ul>
                            <li>the <a href="#a-cucumber-test">anatomy of a Cucumber test</a>, to understand the basics</li>
                            <li>the <a href="#steps-reference">reference list of Gherkin steps</a> which can be used to specify EPUBCheck test scenarios</li>
                            <li>the <a href="#test-files-organization">directory organization and naming conventions for test files</a></li>
                            <li>the <a href="#underlying-java-code">underlying Java code</a> for step definitions, Cucumber typing configuration, EPUBCheck glue code, etc. (this section is targeted at EPUBCheck developers, and is not required reading for people who only want to contribute new tests).</li>
                        </ul>
                        <h3 id="a-cucumber-test"><a class="direct-link" href="#a-cucumber-test">§</a> A Cucumber Test</h3>
                        <p>Test cases, also known as <em>scenarios</em> in Cucumber lingo, are defined in <em>feature files</em> (files with a <code>.feature</code> extension) as a set of readable instructions, called <em>steps</em>.<br>
Here is an example of the content of a simple feature file:</p>
                            <pre><code>Feature: Validate EPUB 3
  
  EPUBCheck should check conformance to the latest EPUB 3 specifications,
  available at: https://www.w3.org/publishing/epub3/

  Background: 
    Given EPUB test files located at '/epub3/files/epub/'
    And EPUBCheck with default settings

  Scenario: valid EPUB
    When checking EPUB 'minimal'
    Then no errors or warnings are reported

  Scenario: invalid EPUB
    When checking EPUB 'schema-error'
    Then error RSC-005 is reported
    And no other errors or warnings are reported
</code></pre>
                            <p>This feature file contains two tests, one for a valid EPUB, the other for an invalid EPUB (due to a schema error).<br>
It has a specific structure, and some lines start with a <em>keyword</em> (<code>Feature</code>, <code>Scenario</code>, <code>Given</code>, <code>When</code>, <code>Then</code>, <code>And</code>, etc), but is generally fairly readable.<br>
Let’s take it apart and describe what it means, piece by piece.</p>
                                <p>The first line of a feature file consists of the keyword <code>Feature</code>, followed by a colon and a title:</p>
                                <pre><code>Feature: Validate EPUB 3
</code></pre>
                                <p>The title (here, &quot;Validate EPUB 3&quot;) should briefly identify the topic or feature being tested.<br>
It will be present in the test report produced by Cucumber, and can be used by the evaluator to know what the tests are about.</p>
                                    <p>The next lines contain a longer description of the topic or feature being tested:</p>
                                    <pre><code>  EPUBCheck should check conformance to the latest EPUB 3 specifications,
  available at: https://www.w3.org/publishing/epub3/
</code></pre>
                                    <p>This longer description is optional.<br>
It can be of any lengh, and ends when the next line starts with a keyword (typically <code>Background</code> or <code>Scenario</code>).<br>
In the EPUBCheck test suite, the feature description is used to explain what part of the EPUB specifications is tested.</p>
                                        <p>After the feature description comes a <code>Background</code> section, here containing two steps:</p>
                                        <pre><code>  Background: 
    Given EPUB test files located at '/epub3/files/epub/'
    And EPUBCheck with default settings
</code></pre>
                                        <p>A <em>step</em> is any line starting with any of the keywords <code>Given</code>, <code>When</code>, <code>Then</code>, <code>And</code>, or <code>But</code>.<br>
Each step is associated with some Java code (see the section <a href="#underlying-java-code">Underlying Java Code</a>);<br>
Cucumber will execute this code in sequence, one step at a time, when running the tests.<br>
The steps included in a <code>Background</code> section will be run before each scenario.<br>
This section is therefore useful to define the initial steps shared by all the tests in the feature file.</p>
                                            <p>In the EPUBCheck test suite, <code>Background</code> section is used to define the location where to find the test files, and to specify the EPUBCheck configuration shared by all the tests in the feature.<br>
These steps and their syntax are described at length in the <a href="#steps-reference">Steps Reference</a>.</p>
                                            <p>The rest of the feature file basically consists of <code>Scenario</code> sections.<br>
Each scenario describes one test case, as a sequence of steps.<br>
It also has a title, consisting of the text string after the colon character following the <code>Scenario</code> keyword.<br>
The scenario titles are arbitrary; they are used to identify the different scenarios in the test report.</p>
                                                <p>For instance, the first <code>Scenario</code> in our example feature file is named &quot;valid EPUB&quot; and checks that no errors or warnings are reported when EPUBCheck is run on a minimalistic valid EPUB:</p>
                                                <pre><code>  Scenario: valid EPUB
    When checking EPUB 'minimal'
    Then no errors or warnings are reported
</code></pre>
                                                <p>Because the feature file contains a <code>Background</code> section (as seen earlier), the sequence of steps that are actually executed when evaluating this test case are the following:</p>
                                                <pre><code>    Given EPUB test files located at '/epub3/files/epub/'
    And EPUBCheck with default settings
    When checking EPUB 'minimal'
    Then no errors or warnings are reported
</code></pre>
                                                <p>This sequence of steps follows a typical pattern that is found in all the scenarios:</p>
                                                <ol>
                                                    <li>description of the initial context (steps <code>Given</code> and <code>And</code> above)</li>
                                                    <li>description of an action (step <code>When</code>)</li>
                                                    <li>description of the expected result (step <code>Then</code>)</li>
                                                </ol>
                                                <p>Note that a scenario can have any number of steps.<br>
The keywords <code>And</code> and <code>But</code> can be used to improve the reading flow.<br>
In fact, the step keywords are not actually differentiated in the underlying implementation, they just improve the readability.<br>
A sequence &quot;<em>given</em> a context, <em>when</em> this happens <em>and</em> this also happens, <em>then</em> this is expected <em>but</em> this isn't expected&quot;<br>
is more readable than the equivalent sequence &quot;<em>given</em> a context, <em>when</em> this happens <em>when</em> this also happens, <em>then</em> this is expected <em>then</em> this isn't expected&quot;,<br>
or even the also equivalent but illegible sequence &quot;<em>then</em> a context, <em>then</em> this happens <em>then</em> this also happens, <em>then</em> this is expected <em>then</em> this isn't expected&quot;.</p>
                                                <p>The second scenario in our sample feature file describes a test for when EPUBCheck is expected to report an error for an invalid EPUB:</p>
                                                <pre><code>  Scenario: invalid EPUB
    When checking EPUB 'schema-error'
    Then error RSC-005 is reported
    And no other errors or warnings are reported
</code></pre>
                                                <p>At this point, it is important to note that the text of the steps (for instance &quot;checking EPUB 'schema-error'&quot; or &quot;error RSC-005 is reported&quot;) is what is used by Cucumber to identify what piece of Java code to execute in order to run the test.<br>
Each step should correspond to a matching <em>step definition</em>, i.e. a Java method that implements the step’s logic.</p>
                                                <p>However, test authors typically do not have to write any line of Java code themselves, as the EPUBCheck test suite already includes a collection of step definitions which intend to cover the variety of EPUBCheck test cases.<br>
Writing a new test case for EPUBCheck consists of describing a scenario in a plain text feature file, using any of the readily available steps listed in the <a href="#steps-reference">Steps reference</a> below.</p>
                                                <h3 id="steps-reference"><a class="direct-link" href="#steps-reference">§</a> Steps reference</h3>
                                                <p><em>Note</em>: the steps in this reference are described using the <a href="https://cucumber.io/docs/cucumber/cucumber-expressions/">Cucumber expression</a> used in the matching step definition.<br>
In this notation, text in parenthesis is optional text, text in curly brackets identify typed parameters, and text around a slash character denotes alternative spellings.</p>
                                                    <p><em>Note</em>: If you’re writing a test and find a use case for a new step that is not in this collection of steps,<br>
please <a href="https://github.com/w3c/epubcheck/issues/new">file an issue</a> or <a href="https://github.com/w3c/epubcheck/compare">submit a pull request</a>!</p>
                                                    <h4 id="setting-the-location-of-test-files"><a class="direct-link" href="#setting-the-location-of-test-files">§</a> Setting the location of test files</h4>
                                                    <hr>
                                                    <p><strong>Step</strong>: <code>(EPUB )test files located at {string}</code></p>
                                                    <p>This step is used to set a base directory where test files can be found.<br>
The <code>{string}</code> parameter is the path of the base directory, relative to the <code>src/test/resources</code> directory.<br>
Test files are the EPUB content used in the test cases;<br>
they can be expanded EPUB file sets, packaged EPUBs, single content documents, package documents, etc.</p>
                                                        <p><strong>Examples</strong>:</p>
                                                        <pre><code>Given EPUB test files located at '/epub3/files/epub/'
</code></pre>
                                                        <pre><code>Given test files located at '/epub3/files/content-document-xhtml/'
</code></pre>
                                                        <hr>
                                                        <h4 id="configuring-epubcheck"><a class="direct-link" href="#configuring-epubcheck">§</a> Configuring EPUBCheck</h4>
                                                        <hr>
                                                        <p><strong>Step</strong>: <code>EPUBCheck with default settings</code></p>
                                                        <p>This step is essentially a no-op:<br>
it indicates that EPUBCheck is instantiated with its default configuration.</p>
                                                            <hr>
                                                            <p><strong>Step</strong>: <code>EPUBCheck configured to check a(n) {checkerMode}</code></p>
                                                            <p>This step is used to configure the type of file expected as input to EPUBCheck.<br>
The <code>{checkerMode}</code> parameter can be any of the following values (case insensitive):</p>
                                                            <ul>
                                                                <li><code>full publication</code></li>
                                                                <li><code>Media Overlays Document</code></li>
                                                                <li><code>Navigation Document</code></li>
                                                                <li><code>Package Document</code></li>
                                                                <li><code>SVG Content Document</code></li>
                                                                <li><code>XHTML Content Document</code></li>
                                                            </ul>
                                                            <p><strong>Examples</strong>:</p>
                                                            <pre><code>Given EPUBCheck configured to check a full publication
</code></pre>
                                                            <pre><code>Given EPUBCheck configured to check an XHTML Content Document
</code></pre>
                                                            <pre><code>Given EPUBCheck configured to check a navigation document
</code></pre>
                                                            <hr>
                                                            <h4 id="running-epubcheck"><a class="direct-link" href="#running-epubcheck">§</a> Running EPUBCheck</h4>
                                                            <hr>
                                                            <p><strong>Step</strong>: <code>checking EPUB/document/file {string}</code></p>
                                                            <p>This step executes EPUBCheck with the given document as input.<br>
The <code>{string}</code> parameter is the path of the test document, relative to <a href="#setting-the-location-of-test-files">the base directory of test files</a>.<br>
Given the <a href="#test-files-organization">flat organization of test files</a>, it is typically just the name of the test file (or directory, for expanded EPUBs).</p>
                                                            <p><strong>Examples</strong>:</p>
                                                            <pre><code>When checking EPUB 'minimal'
</code></pre>
                                                            <pre><code>When checking EPUB 'minimal.epub'
</code></pre>
                                                            <pre><code>When checking document 'valid-content.xhtml'
</code></pre>
                                                            <pre><code>When checking file 'invalid-file.foo'
</code></pre>
                                                            <p>Note that it is possibe to use a <code>Scenario Outline</code> (also known as a scenario template) to test several input files using the same step sequence.<br>
For instance:</p>
                                                                <pre><code>Scenario Outline: valid EPUB &lt;EPUB&gt;
  When checking EPUB '&lt;EPUB&gt;'
  Then no errors or warnings are reported

  Examples:
    | EPUB               |
    | minimal.epub       |
    | fallbacks.epub     |
    | mediaoverlays.epub |
</code></pre>
                                                                <hr>
                                                                <h4 id="expecting-epubcheck-results"><a class="direct-link" href="#expecting-epubcheck-results">§</a> Expecting EPUBCheck results</h4>
                                                                <hr>
                                                                <p><strong>Step</strong>: <code>no( other) warning(s)/error(s) or error(s)/warning(s) are/is reported</code></p>
                                                                <p>This step asserts that the stack of warnings and error messages reported by EPUBCheck is empty.<br>
It may be used either:</p>
                                                                    <ul>
                                                                        <li>as the first assertion step, to verify that no errors or warnings <em>at all</em> were reported by EPUBCheck,<br>
i.e. that the input is fully conforming to the specifications.<br>
In that case, the word &quot;other&quot; should be ommitted (&quot;no warnings or errors are reported&quot;).</li>
                                                                        <li>following assertion steps which checked that some isses were reported, to verify that no <em>other</em> issues were found.<br>
In that case, the word &quot;other&quot; should be present (&quot;no other errors or warnings are reported&quot;).</li>
                                                                    </ul>
                                                                    <p>It is important to note that the assertion steps <em>consume</em> the messages.<br>
For example, when a test description to use a sequence of assertions like:</p>
                                                                        <pre><code>Then error X is reported
And warning Y is reported
And no other warnings or errors are reported
</code></pre>
                                                                        <p>the first step asserts that error X exists in the list of reported messages and consumes it; the next step asserts that warning Y exists and consumes it; finally the last step verifies that the list of messages is left with no other warnings or errors.</p>
                                                                        <p><strong>Examples:</strong></p>
                                                                        <pre><code>Then no errors or warnings are reported
</code></pre>
                                                                        <pre><code>Then no error is reported
</code></pre>
                                                                        <pre><code>And no other errors or warnings are reported
</code></pre>
                                                                        <pre><code>And no other warnings are reported
</code></pre>
                                                                        <hr>
                                                                        <p><strong>Step</strong>: <code>(the ){severity} {messageId} is reported</code></p>
                                                                        <p>This step asserts that a specific message (typically a warning or error) was reported by EPUBCheck.<br>
The <code>{severity}</code> parameter must be a case-insensitive match to either <code>ERROR</code>, <code>WARNING</code>, <code>INFO</code>, <code>USAGE</code>, or <code>FATAL</code>.<br>
The <code>messageId</code> parameter must be a cases-sensitive match to an EPUBCheck message ID, as defined in the <a href="https://github.com/w3c/epubcheck/blob/master/src/main/java/com/adobe/epubcheck/messages/MessageId.java"><code>MessageId.java</code> class</a> (for example, <code>RSC-005</code>, or <code>PKG-010</code>, or <code>OPF-086b</code>).<br>
Message IDs can use a hyphen ('-') or an underscore ('_') interechangeably.</p>
                                                                            <p><strong>Examples:</strong></p>
                                                                            <pre><code>Then error RSC-005 is reported
</code></pre>
                                                                            <pre><code>Then WARNING RSC-009 is reported
</code></pre>
                                                                            <hr>
                                                                            <p><strong>Step</strong>: <code>(the ){severity} {messageId} is reported {int} time(s)</code></p>
                                                                            <p>This step asserts that a specific message (typically a warning or error) was reported several times by EPUBCheck.<br>
The <code>{severity}</code> parameter must be a case-insensitive match to either <code>ERROR</code>, <code>WARNING</code>, <code>INFO</code>, <code>USAGE</code>, or <code>FATAL</code>.<br>
The <code>messageId</code> parameter must be a cases-sensitive match to an EPUBCheck message ID, as defined in the <a href="https://github.com/w3c/epubcheck/blob/master/src/main/java/com/adobe/epubcheck/messages/MessageId.java"><code>MessageId.java</code> class</a> (for example, <code>RSC-005</code>, or <code>PKG-010</code>, or <code>OPF-086b</code>).<br>
Message IDs can use a hyphen ('-') or an underscore ('_') interechangeably.<br>
The <code>{int}</code> paraameter must be an integer, equals to the number of times the message is expected to be reported.</p>
                                                                            <p>It is important to note that this step asserts that the message is reported <strong>at least</strong> the given number of times.<br>
In order to ensure that it is not reported more than that, the step must be combine with a &quot;no other warnings or errors are reported&quot; step.</p>
                                                                                <p><strong>Examples:</strong></p>
                                                                                <pre><code>Then error RSC-005 is reported 3 times
</code></pre>
                                                                                <pre><code>And warning RSC-009 is reported 1 time
</code></pre>
                                                                                <hr>
                                                                                <p><strong>Step</strong>: <code>(the )following {severity}( ID)(s) are/is reported</code></p>
                                                                                <p>This step asserts that a list of messages of a same severity (typically error or warning) are reported by EPUBCheck.<br>
The <code>{severity}</code> parameter must be a case-insensitive match to either <code>ERROR</code>, <code>WARNING</code>, <code>INFO</code>, <code>USAGE</code>, or <code>FATAL</code>.<br>
A list of expected message IDs must be given as a <a href="https://cucumber.io/docs/gherkin/reference/#data-tables">data table</a>, in the fist column.<br>
Each element in the list must be a cases-sensitive match to an EPUBCheck message ID, as defined in the <a href="https://github.com/w3c/epubcheck/blob/master/src/main/java/com/adobe/epubcheck/messages/MessageId.java"><code>MessageId.java</code> class</a> (for example, <code>RSC-005</code>, or <code>PKG-010</code>, or <code>OPF-086b</code>).<br>
Message IDs can use a hyphen ('-') or an underscore ('_') interechangeably.<br>
A second column of the data table can be used to specify a text string that the reported message is expected to contain.</p>
                                                                                    <p><strong>Examples:</strong></p>
                                                                                    <pre><code>Then the following warning IDs are reported
      | RSC-017 |
      | RSC-018 |
</code></pre>
                                                                                    <pre><code>Then the following errors are reported
      | RSC-005 | attribute &quot;foo&quot; not allowed here |
      | RSC-005 | element &quot;bar&quot; not allowed here   |
</code></pre>
                                                                                    <hr>
                                                                                    <p><strong>Step</strong>: <code>(the )message is {string}</code></p>
                                                                                    <p>This step asserts that the text of the last consumed message is equal to the given content.<br>
The <code>{string}</code> parameter is the expected text of the message.</p>
                                                                                    <p>This step should only be used after a step that verified that a given message ID was reported.</p>
                                                                                    <p><strong>Examples:</strong></p>
                                                                                    <pre><code>Then error RSC-005 is reported
And the message is 'attribute &quot;foo&quot; not allowed here'
</code></pre>
                                                                                    <hr>
                                                                                    <p><strong>Step</strong>: <code>(the )message contains {string}</code></p>
                                                                                    <p>This step asserts that the text of the last consumed message contains the given content.<br>
The <code>{string}</code> parameter is the text that the message is expected to contain.</p>
                                                                                    <p>This step should only be used after a step that verified that a given message ID was reported.</p>
                                                                                    <p><strong>Examples:</strong></p>
                                                                                    <pre><code>Then error RSC-005 is reported
And the message contains 'Duplicate ID'
</code></pre>
                                                                                    <hr>
                                                                                    <h3 id="test-files-organization"><a class="direct-link" href="#test-files-organization">§</a> Test Files Organization</h3>
                                                                                    <h4 id="directory-layout"><a class="direct-link" href="#directory-layout">§</a> Directory layout</h4>
                                                                                    <p>The source code in EPUBCheck is following the ususal <a href="https://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html">Maven standard directory layout</a>:</p>
                                                                                    <ul>
                                                                                        <li>Java test sources are located in the <code>src/test/java</code> directory</li>
                                                                                        <li>test resources are located in the <code>src/test/resources</code> directory.</li>
                                                                                    </ul>
                                                                                    <p>The test resources related to the functional tests consist of the Gherkin feature files and all the test files used as input for EPUBCheck.<br>
The directory layout for the test resources is the following:</p>
                                                                                        <ol>
                                                                                            <li>test resources for EPUB 2 and EPUB 3 are located in distinct top-level directories, respectively named <code>epub2</code> and <code>epub3</code>, hereafter called <em>version directories</em>.</li>
                                                                                            <li>each version directory contains:</li>
                                                                                        </ol>
                                                                                        <ul>
                                                                                            <li>a list of Gherkin feature files (<code>.feature</code> extension) describing the tests for the related version of the EPUB specifications.<br>
How the tests are organized in feature files is further defined in the <a href="#feature-files-organiztion">Feature files organization</a> section below.</li>
                                                                                            <li>a <code>files</code> directory containing subdirectories for each type of test files used as input for EPUBCheck (e.g. whole EPUB or single Content Document).<br>
All the test files are directory contained within these subdirectories.<br>
The list of subdirectories and the naming convention used for test files are further defined in the <a href="#test-files-organization">Test files organization</a> section below.</li>
                                                                                        </ul>
                                                                                        <p>To give an example, the directory layout for functional tests looks like the following file and directory structure:</p>
                                                                                        <pre><code>src/test/resources
├── epub2
│   ├── container-epub.feature
│   ├── content-document-xhtml.feature
│   ├── navigation-ncx-document.feature
│   ├── package-document.feature
|   ├── …
|   └── files
│       ├── epub
│       ├── content-document-xhtml
│       ├── ncx-document
│       ├── package-document
│       └── …
└── epub3
    ├── core-container-epub.feature
    ├── core-content-document-xhtml.feature
    ├── core-navigation-document.feature
    ├── core-navigation-epub.feature
    ├── …
    └── files
        ├── epub
        ├── content-document-xhtml
        ├── navigation-document
        ├── package-document
        └── …
</code></pre>
                                                                                        <h4 id="feature-files-organization"><a class="direct-link" href="#feature-files-organization">§</a> Feature files organization</h4>
                                                                                        <p>The EPUBCheck test suite includes hundreds of tests for each version of EPUB.<br>
It would be impractical to include all of them in a single massive feature file.<br>
Instead, tests are distributed in various feature files, organized by tested topic.</p>
                                                                                            <p>As the EPUB format is actually defined in a family of specficiations, the first way to categorize tests is by related specifications.<br>
For example, some feature files describe the tests for the rules defined in the EPUB Packages specification (for example, <code>core-package-epub.feature</code>), and other feature files describe the tests for the rules defined in the EPUB Content Document specification (for example, <code>core-content-document-xhtml.feature</code>).<br>
Satellite specifications (some of which are not widely adopted, but still supported by EPUBCheck) are also covered in distinct feature files (for example, <code>indexes-epub.feature</code> or <code>edupub-epub.feature</code>).<br>
In addition, some sections within the specifications are cohesive enough to justify having their own feature file (for example, <code>core-navigation-epub.feature</code>, or <code>core-fixedlayout-epub.feature</code>).<br>
Finally, a same topic can be split in several feature files depending on the nature of the tested input document (for example, <code>core-navigation-epub.feature</code> contains the navigation-related tests based on full EPUB publications, while <code>core-navigation-document.feature</code> contains the tests based on validating a single Navigation Document).</p>
                                                                                            <p>By convention, the name of feature files follow this pattern:</p>
                                                                                            <pre><code>{specification}-{topic?}-{input-type}-{specialization?}
</code></pre>
                                                                                            <p>where:</p>
                                                                                            <ul>
                                                                                                <li><code>{specification}</code> identifies the specification (or family of specifications) containing the rules being tested, which can be any of: <ul>
                                                                                                        <li><code>core</code>: the core family of EPUB specifications, including EPUB, EPUB Packages, EPUB Content Documents, and EPUB Open Container Format.</li>
                                                                                                        <li><code>dictionaries</code>: the EPUB Dictionaries specification</li>
                                                                                                        <li><code>edupub</code>: the EDUPUB specification</li>
                                                                                                        <li><code>indexes</code>: the EPUB Indexes specification</li>
                                                                                                        <li><code>mediaoverlays</code>: the EPUB Media Overlays specification</li>
                                                                                                        <li><em>not specified</em> for EPUB 2.0.1, which doesn’t have satellite specifications</li>
                                                                                                    </ul>
                                                                                                </li>
                                                                                                <li><code>{topic}</code> may optionally be used to identify the sub-topic being tested, which can be any of: <ul>
                                                                                                        <li><code>container</code>: tests related to the EPUB Open Container Format (OCF)</li>
                                                                                                        <li><code>content</code>: tests related to EPUB Content Documents</li>
                                                                                                        <li><code>fixedlayout</code>: tests related to Fixed Layout EPUBs</li>
                                                                                                        <li><code>navigation</code>: tests related to the EPUB Navigation Document (or NCX in EPUB 2.0.1)</li>
                                                                                                        <li><code>package</code>: tests related to EPUB Packages</li>
                                                                                                        <li><code>resources</code>: tests related to Publication Resources</li>
                                                                                                    </ul>
                                                                                                </li>
                                                                                                <li><code>{input-type}</code> is the kind of document being used as input for the tests, which can be any of: <ul>
                                                                                                        <li><code>epub</code>: tests based on the validation of full EPUB publications, either packages (<code>.epub</code> files) or unpackages (directories)</li>
                                                                                                        <li><code>content-document</code>: tests based on the validation of single EPUB Content Documents (e.g. <code>.xhtml</code> files)</li>
                                                                                                        <li><code>mediaoverlays-document</code>: tests based on the validation of single EPUB Media Overlays Documents (<code>.smil</code> files)</li>
                                                                                                        <li><code>navigation-document</code>: tests based on the validation of single EPUB Navigation Documents</li>
                                                                                                        <li><code>ncx-document</code>: tests based on the validation of single NCX document (EPUB 2.0.1)</li>
                                                                                                        <li><code>package-document</code>: tests based on the validation of single EPUB Package Documents (<code>.opf</code> files)</li>
                                                                                                    </ul>
                                                                                                </li>
                                                                                                <li><code>{specialization}</code> may optionally be used to further differentiate the type of the input document being tested, for instance: <ul>
                                                                                                        <li><code>xhtml</code>: for XHTML Content Documents</li>
                                                                                                        <li><code>svg</code>: for SVG Content Documents</li>
                                                                                                        <li><code>dtbook</code>: for DTBook Content Documents (EPUB 2.0.1)</li>
                                                                                                    </ul>
                                                                                                </li>
                                                                                            </ul>
                                                                                            <p>when two consecutive segments of the file name are identical, they are not repeated.<br>
For example, the feature file for tests related to the core Navigation Document rules and using single Navigation Documents as input is named <code>core-navigation-document.feature</code> instead of <code>core-navigation-navigation-document.feature</code>.</p>
                                                                                            <p>Note: this naming convention is merely used to establish a consistent organization and help with manual test lookup.<br>
It is not relied upon for the execution of the tests;<br>
all the feature files will be automatically detected by Cucumber when running the test suite.</p>
                                                                                                <p>The feature files describing the tests related to the EPUB 3 specifications are:</p>
                                                                                                <ul>
                                                                                                    <li><code>core-container-epub.feature</code></li>
                                                                                                    <li><code>core-content-document-svg.feature</code></li>
                                                                                                    <li><code>core-content-document-xhtml.feature</code></li>
                                                                                                    <li><code>core-content-epub.feature</code></li>
                                                                                                    <li><code>core-fixedlayout-epub.feature</code></li>
                                                                                                    <li><code>core-navigation-document.feature</code></li>
                                                                                                    <li><code>core-navigation-epub.feature</code></li>
                                                                                                    <li><code>core-package-document.feature</code></li>
                                                                                                    <li><code>core-package-epub.feature</code></li>
                                                                                                    <li><code>core-resources-epub.feature</code></li>
                                                                                                    <li><code>dictionaries-content-document.feature</code></li>
                                                                                                    <li><code>dictionaries-epub.feature</code></li>
                                                                                                    <li><code>dictionaries-package-document.feature</code></li>
                                                                                                    <li><code>edupub-content-document.feature</code></li>
                                                                                                    <li><code>edupub-epub.feature</code></li>
                                                                                                    <li><code>edupub-package-document.feature</code></li>
                                                                                                    <li><code>indexes-content-document.feature</code></li>
                                                                                                    <li><code>indexes-epub.feature</code></li>
                                                                                                    <li><code>mediaoverlays-document.feature</code></li>
                                                                                                    <li><code>mediaoverlays-epub.feature</code></li>
                                                                                                </ul>
                                                                                                <p>The feature files describing the tests related to the EPUB 2.0.1 specifications are:</p>
                                                                                                <ul>
                                                                                                    <li><code>container-epub.feature</code></li>
                                                                                                    <li><code>content-document-dtbook.feature</code></li>
                                                                                                    <li><code>content-document-svg.feature</code></li>
                                                                                                    <li><code>content-document-xhtml.feature</code></li>
                                                                                                    <li><code>content-epub.feature</code></li>
                                                                                                    <li><code>navigation-ncx-document.feature</code></li>
                                                                                                    <li><code>navigation-epub.feature</code></li>
                                                                                                    <li><code>package-document.feature</code></li>
                                                                                                    <li><code>package-epub.feature</code></li>
                                                                                                    <li><code>resources-epub.feature</code></li>
                                                                                                </ul>
                                                                                                <p>Note: this categorization of tests in feature files may not be definitive. The organization can easily be adapted and may evolve depending on test writers and developers feedback. Feel free to <a href="https://github.com/w3c/epubcheck/issues/new">file an issue</a> or <a href="https://github.com/w3c/epubcheck/compare">submit a pull request</a> to add a new feature file, or suggest an improvement to this organization.</p>
                                                                                                <h4 id="test-files-organization-2"><a class="direct-link" href="#test-files-organization-2">§</a> Test files organization</h4>
                                                                                                <p>All the functional tests for EPUBCheck are based on running EPUBCheck on a sample input file or directory, and inspecting that the returned messages are conforming to the expectations.<br>
As a result, the test resources directory contains many test files, that are used by the tests described in the feature files.<br>
This section describes the directory structure and naming convention used to to organize this big collection of test material in a consistent and maintainable manner.</p>
                                                                                                    <p><em>TODO</em> further define the naming convention.</p>
                                                                                                    <h3 id="underlying-java-code"><a class="direct-link" href="#underlying-java-code">§</a> Underlying Java code</h3>
                                                                                                    <p>_<em>Note: this section is targeted at EPUBCheck developers; it is not required reading for people who only want to contribute new tests</em></p>
                                                                                                    <p>The Java code implementing the functional tests primarily consists of the following classes:</p>
                                                                                                    <ul>
                                                                                                        <li>Test runners: <ul>
                                                                                                                <li><code>RunCucumberTest.java</code></li>
                                                                                                                <li><code>DebugCucumberTest.java</code></li>
                                                                                                            </ul>
                                                                                                        </li>
                                                                                                        <li>Step definitions: <ul>
                                                                                                                <li><code>ExecutionSteps.java</code></li>
                                                                                                                <li><code>AssertionSteps.java</code></li>
                                                                                                            </ul>
                                                                                                        </li>
                                                                                                        <li>Type configuration: <ul>
                                                                                                                <li><code>TypeRegistryConfiguration.java</code></li>
                                                                                                            </ul>
                                                                                                        </li>
                                                                                                        <li>Domain classes: <ul>
                                                                                                                <li><code>TestReport.java</code></li>
                                                                                                                <li><code>MessageInfo.java</code></li>
                                                                                                            </ul>
                                                                                                        </li>
                                                                                                    </ul>
                                                                                                    <p><em>TODO</em>: further describe the Java code.</p>
                                                                                                    <h2 id="unit-tests"><a class="direct-link" href="#unit-tests">§</a> Unit tests</h2>
                                                                                                    <p>The list of test classes containing unit tests for the various APIs or helper classes is:</p>
                                                                                                    <ul>
                                                                                                        <li><code>com.adobe.epubcheck.api.ApiConstructorsTest.java</code></li>
                                                                                                        <li><code>com.adobe.epubcheck.ocf.OCFFilenameCheckerTest.java</code></li>
                                                                                                        <li><code>com.adobe.epubcheck.opf.MetadataSetTest.java</code></li>
                                                                                                        <li><code>com.adobe.epubcheck.util.DateParserTest.java</code></li>
                                                                                                        <li><code>com.adobe.epubcheck.util.OPFPeekerTest.java</code></li>
                                                                                                        <li><code>com.adobe.epubcheck.util.PathUtilTest.java</code></li>
                                                                                                        <li><code>com.adobe.epubcheck.util.SourceSetTest.java</code></li>
                                                                                                        <li><code>com.adobe.epubcheck.vocab.PrefixParsingTest.java</code></li>
                                                                                                        <li><code>com.adobe.epubcheck.vocab.PropertyTest.java</code></li>
                                                                                                        <li><code>com.adobe.epubcheck.vocab.VocabTest.java</code></li>
                                                                                                        <li><code>org.idpf.epubcheck.util.css.CssInputStreamTest.java</code></li>
                                                                                                        <li><code>org.idpf.epubcheck.util.css.CssParserTest.java</code></li>
                                                                                                        <li><code>org.idpf.epubcheck.util.css.CssScannerTest.java</code></li>
                                                                                                    </ul>
                                                                                                    <p><em>TODO</em>: describe the topic covered by each test class</p>
                                                                                                    <h2 id="integration-tests"><a class="direct-link" href="#integration-tests">§</a> Integration tests</h2>
                                                                                                    <h2 id="how-to-run-tests"><a class="direct-link" href="#how-to-run-tests">§</a> How to Run Tests</h2>
                                                                                                    <h3 id="running-tests-from-the-command-line"><a class="direct-link" href="#running-tests-from-the-command-line">§</a> Running tests from the command line</h3>
                                                                                                    <p>To run the whole EPUBCheck test suite:</p>
                                                                                                    <pre><code>mvn clean verify
</code></pre>
                                                                                                    <p>Note that the previous command will run all the functional, unit, and integration tests.<br>
To run all the tests except the integration tests, the following command can be used:</p>
                                                                                                        <pre><code>mvn clean test
</code></pre>
                                                                                                        <p>It is also possible to run a single test class using the <code>test</code> property:</p>
                                                                                                        <pre><code>mvn -Dtest=VocabTest test
</code></pre>
                                                                                                        <p><em>TODO</em>: describe what the results look like, how to read them.</p>
                                                                                                        <h3 id="running-tests-from-the-development-environment"><a class="direct-link" href="#running-tests-from-the-development-environment">§</a> Running tests from the development environment</h3>
                                                                                                        <p>Some development environments support running tests from their UI, either natively or with extension plugins.</p>
                                                                                                        <p>In Eclipse, the default JUnit plugin can be used to run all the tests, including the Cucumber functional tests (as they're run trought the JUnit Cucumber test runner).<br>
A Cucumber plugin is also available, which includes formatting for Gherkin feature files, as well as the ability to run Cucumber directly from feature files.</p>
                                                                                                            <p><em>TODO</em>: add links to the recommended plugins + list of UI steps to run a test in Eclipse?</p>
                                                                                                            <h3 id="tips-to-run-and-debug-a-single-test"><a class="direct-link" href="#tips-to-run-and-debug-a-single-test">§</a> Tips to run and debug a single test</h3>
                                                                                                            <p><em>TODO</em>: describe how to debug a single Cucumber test, using the <code>@debug</code> tag.</p>
    </main>
    <nav aria-labelled-by="localnavtitle">
        <h1 id="localnavtitle">Developer Guide Sections</h1>
        <ul>
            <li><a href="/epubcheck-website/docs/dev">Introduction</a></li>
            <li><a href="/epubcheck-website/docs/dev/i18n">Translating EPUBcheck</a></li>
            <li><a href="/epubcheck-website/docs/dev/issues">Issue tracker</a></li>
            <li><a href="/epubcheck-website/docs/dev/commits">Writing commits</a></li>
            <li><a href="/epubcheck-website/docs/dev/build">Build and test</a></li>
            <li><a href="/epubcheck-website/docs/dev/releases">Releases</a></li>
            <li><a href="/epubcheck-website/docs/dev/testsuite">Test Suite</a></li>
            <li><a href="/epubcheck-website/docs/dev/codebase">Codebase</a></li>
        </ul>
    </nav>
    <footer>
        <p>Last updated today at 6:04 PM</p>
    </footer>
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", e => {
            document.querySelector("form#search input[name='q']").addEventListener("keydown", e => {
                if (e.keyCode == 13) {
                    e.target.form.submit();
                }
            });
        });
    </script>
    <script type="module" src="/epubcheck-website/versions.js"></script>
    <script type="module" src="/epubcheck-website/site.js"></script>
    <script type="module"> import { getLatest } from '/epubcheck-website/versions.js';
            import { getSitePath, getDocsPath } from '/epubcheck-website/site.js';

            document.addEventListener("DOMContentLoaded", e => {
                if ( "0.1.0" != getLatest() ) {
                    showAlert("0.1.0", getLatest());
                }
            });
            function showAlert(thisVersion, latestVersion) {
                let alert = document.createElement("p");
                alert.classList.add("alert");
                alert.innerHTML = `You are viewing an old version (0.1.0).`;
                let tags = ['docs',];
                if (tags.includes("docs")) {
                    alert.innerHTML += ` <a href="${getDocsPath('')}">View the latest documentation</a>.`;
                } 
                else {
                    alert.innerHTML += ` <a href="${getSitePath('')}">View the latest site</a>.`;
                }
                let header = document.querySelector("header");
                header.prepend(alert);
            }
        </script>
</body>

</html>